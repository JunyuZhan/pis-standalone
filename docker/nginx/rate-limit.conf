# ============================================
# Nginx 速率限制配置
# 用途: 防止 DoS 攻击和资源耗尽
# ============================================

# 定义速率限制区域
# 格式: limit_req_zone $binary_remote_addr zone=名称:内存大小 rate=速率;

# 上传接口限制：每个 IP 每分钟 10 次请求
limit_req_zone $binary_remote_addr zone=upload_limit:10m rate=10r/m;

# API 接口限制：每个 IP 每分钟 60 次请求
limit_req_zone $binary_remote_addr zone=api_limit:10m rate=60r/m;

# 全局限制：每个 IP 每分钟 100 次请求
limit_req_zone $binary_remote_addr zone=global_limit:10m rate=100r/m;

# 在 server 块中使用：
# 
# location /api/admin/albums/[id]/upload {
#     limit_req zone=upload_limit burst=5 nodelay;
#     limit_req_status 429;
#     proxy_pass http://nextjs:3000;
# }
#
# location /api/ {
#     limit_req zone=api_limit burst=20 nodelay;
#     limit_req_status 429;
#     proxy_pass http://nextjs:3000;
# }
#
# location / {
#     limit_req zone=global_limit burst=50 nodelay;
#     proxy_pass http://nextjs:3000;
# }

# 说明：
# - burst: 允许突发请求数（超过速率限制时的缓冲）
# - nodelay: 立即处理突发请求，不延迟
# - limit_req_status: 超过限制时返回的 HTTP 状态码（默认 503，建议 429）
