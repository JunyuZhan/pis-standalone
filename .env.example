# ===========================================
# PIS 环境变量配置示例
# 
# 使用方法:
#   1. 复制此文件: cp .env.example .env
#   2. 编辑 .env 文件，填入实际配置值
#   3. 不要将 .env 文件提交到 Git（已在 .gitignore 中）
#
# 注意: 此文件中的占位符（如 AUTO_GENERATE）会被部署脚本自动替换
# ===========================================

# ==================== 数据库配置 ====================
# 数据库类型：postgresql（自托管，推荐）或 supabase（云服务，向后兼容）
DATABASE_TYPE=postgresql

# PostgreSQL 连接配置（方式1：使用连接字符串）
# DATABASE_URL=postgresql://user:password@host:5432/database?sslmode=require

# PostgreSQL 连接配置（方式2：分别配置，推荐）
# 注意：Docker 容器内应使用容器名（如 postgres），而不是 localhost
# 部署脚本会自动替换为正确的容器名
DATABASE_HOST=localhost
DATABASE_PORT=5432
DATABASE_NAME=pis
DATABASE_USER=pis
DATABASE_PASSWORD=AUTO_GENERATE_32
DATABASE_SSL=false

# PostgreSQL 容器密码（Docker 部署时使用，会自动与 DATABASE_PASSWORD 同步）
POSTGRES_DB=pis
POSTGRES_USER=pis
POSTGRES_PASSWORD=AUTO_GENERATE_32

# ==================== 认证配置 ====================
# JWT 签名密钥（用于会话管理，必须与 Worker 服务器一致）
# 至少 32 字符，建议使用 64 字符十六进制字符串
AUTH_JWT_SECRET=AUTO_GENERATE_32

# 相册会话密钥（用于加密相册访问 token）
# 部署脚本会自动生成，或手动设置 64 字符十六进制字符串
ALBUM_SESSION_SECRET=AUTO_GENERATE_32

# ==================== MinIO 存储配置 ====================
# 存储类型：minio（自托管）、oss（阿里云）、cos（腾讯云）、s3（AWS）
STORAGE_TYPE=minio

# MinIO 配置（STORAGE_TYPE=minio 时使用）
# 注意：Docker 容器内应使用容器名（如 pis-minio），而不是 localhost
# 部署脚本会自动替换为正确的容器名
STORAGE_ENDPOINT=localhost
STORAGE_PORT=9000
STORAGE_USE_SSL=false
STORAGE_ACCESS_KEY=minioadmin
STORAGE_SECRET_KEY=minioadmin
STORAGE_BUCKET=pis-photos
# 单端口模式下，公网访问通过 Nginx 代理（如 http://localhost:8088/media）
STORAGE_PUBLIC_URL=http://localhost:8088/media

# 兼容旧配置（MinIO）
# 注意：Docker 容器内应使用容器名（如 pis-minio），而不是 localhost
# 部署脚本会自动替换为正确的容器名
MINIO_ENDPOINT_HOST=localhost
MINIO_ENDPOINT_PORT=9000
MINIO_USE_SSL=false
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=minioadmin
MINIO_BUCKET=pis-photos
# 单端口模式下，公网访问通过 Nginx 代理（如 http://localhost:8088/media）
MINIO_PUBLIC_URL=http://localhost:8088/media

# ==================== Worker 服务配置 ====================
# Worker API URL（服务端使用）
# 注意：Docker 容器内应使用容器名（如 http://pis-worker:3001），而不是 localhost
# 部署脚本会自动替换为正确的容器名
WORKER_URL=http://localhost:3001
WORKER_API_URL=http://localhost:3001

# Worker API 公网 URL（前端使用，生产环境使用 HTTPS）
# 单端口模式下，前端通过 Nginx 代理访问（如 http://localhost:8088/worker-api）
NEXT_PUBLIC_WORKER_URL=http://localhost:8088/worker-api

# Worker API 认证密钥（必须与 Worker 服务器配置一致）
WORKER_API_KEY=AUTO_GENERATE_32

# ==================== Redis 配置 ====================
# 注意：Docker 容器内应使用容器名（如 redis），而不是 localhost
# 部署脚本会自动替换为正确的容器名
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=

# ==================== 应用配置 ====================
# 应用公网访问地址（用于生成链接、邮件等）
# 单端口模式下，所有访问通过 Nginx 的 8088 端口
# 如果使用 frpc/ddnsto 内网穿透，填写内网穿透提供的域名
# 例如：https://pis.example.com 或 https://yourname.ddnsto.com
NEXT_PUBLIC_APP_URL=http://localhost:8088

# 媒体服务器公网 URL（前端访问媒体文件的地址，生产环境使用 HTTPS）
# 单端口模式下，通过 Nginx 代理访问（如 http://localhost:8088/media）
# 如果使用内网穿透，使用相同的域名
NEXT_PUBLIC_MEDIA_URL=http://localhost:8088/media

# 品牌信息（显示在页面标题、元数据等）
NEXT_PUBLIC_PHOTOGRAPHER_NAME=PIS Photography
NEXT_PUBLIC_PHOTOGRAPHER_TAGLINE=专业活动摄影

# ==================== Cloudflare Turnstile (可选) ====================
# 用于登录页面的机器人验证（防止暴力破解）
# 如果未配置，登录页面将不显示验证码
NEXT_PUBLIC_TURNSTILE_SITE_KEY=
TURNSTILE_SECRET_KEY=

# ==================== Cloudflare CDN 缓存清除 (可选) ====================
# 用于在删除照片时自动清除 CDN 缓存
# 如果未配置，删除照片后 CDN 缓存可能仍存在一段时间
CLOUDFLARE_API_TOKEN=
CLOUDFLARE_ZONE_ID=

# ==================== 向后兼容配置（Supabase，可选）====================
# 如果 DATABASE_TYPE=supabase，需要配置以下变量
# SUPABASE_URL=https://your-project.supabase.co
# SUPABASE_SERVICE_ROLE_KEY=your-service-role-key
# NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
# NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key

# ==================== 轮询配置（可选）====================
# 用于替代 Supabase Realtime 的轮询间隔（毫秒）
# 默认值：3000（3秒）
NEXT_PUBLIC_POLLING_INTERVAL=3000
NEXT_PUBLIC_ADMIN_POLLING_INTERVAL=2000

# ==================== 日志配置（可选）====================
# 日志级别：trace, debug, info, warn, error, fatal
# 默认值：info
LOG_LEVEL=info

# 日志目录（Worker 服务使用，默认：logs）
LOG_DIR=logs

# 是否启用文件日志（Worker 服务，默认：true）
ENABLE_FILE_LOG=true

# 是否启用彩色日志输出（开发环境默认启用）
ENABLE_PRETTY_LOG=false

# ==================== 升级功能配置（可选）====================
# 项目根目录路径（用于升级检查功能）
# Docker 部署时，如果挂载了项目目录到容器，设置此变量指向挂载路径
# 例如：PROJECT_ROOT=/opt/pis
# 如果不设置，系统会尝试自动检测（可能不准确）
PROJECT_ROOT=

# Docker Compose 挂载路径配置（可选）
# 容器内项目根目录的挂载路径（默认 /opt/pis）
# 如果需要在容器内使用不同的路径，可以设置此变量
# 例如：PROJECT_ROOT_MOUNT_PATH=/app/pis
# 注意：此变量需要在 docker-compose.yml 中使用，通常不需要修改
# PROJECT_ROOT_MOUNT_PATH=/opt/pis
