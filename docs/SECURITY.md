# å®‰å…¨æœ€ä½³å®è·µ

> æœ¬æ–‡æ¡£è¯´æ˜ PIS ç³»ç»Ÿçš„å®‰å…¨æªæ–½å’Œéƒ¨ç½²å»ºè®®

**æœ€åæ›´æ–°**: 2026-01-27

---

## ğŸ”’ å®‰å…¨æ£€æŸ¥æ¸…å•

### éƒ¨ç½²å‰å¿…æ£€é¡¹ç›®

- [ ] è¿è¡Œå®‰å…¨æ£€æŸ¥è„šæœ¬: `bash scripts/check-security.sh`
- [ ] éªŒè¯ç¯å¢ƒå˜é‡é…ç½®: `bash scripts/setup.sh` (é€‰é¡¹ 3)
- [ ] ç¡®ä¿ `.env` ä¸åŒ…å«çœŸå®å¯†é’¥
- [ ] æ£€æŸ¥ `.gitignore` æ­£ç¡®é…ç½®æ•æ„Ÿæ–‡ä»¶
- [ ] ç”Ÿäº§ç¯å¢ƒå¯ç”¨ HTTPS
- [ ] é…ç½®å¼ºå¯†ç å’Œå®‰å…¨å¯†é’¥
- [ ] å¯ç”¨ Redis å¯†ç è®¤è¯
- [ ] é…ç½®é˜²ç«å¢™è§„åˆ™
- [ ] è®¾ç½®å¤‡ä»½ç­–ç•¥

### ç¯å¢ƒå˜é‡å®‰å…¨

**âŒ å±é™©é…ç½®**:
```bash
# ä¸è¦åœ¨ä»£ç ä¸­ç¡¬ç¼–ç çœŸå®å¯†é’¥
SUPABASE_SERVICE_ROLE_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
STORAGE_ACCESS_KEY="minioadmin"  # ç”Ÿäº§ç¯å¢ƒä¸è¦ä½¿ç”¨é»˜è®¤å¯†é’¥
```

**âœ… å®‰å…¨é…ç½®**:
```bash
# ä½¿ç”¨å ä½ç¬¦æˆ–ç¯å¢ƒå˜é‡æ³¨å…¥
SUPABASE_SERVICE_ROLE_KEY="your-service-role-key-here"
STORAGE_ACCESS_KEY="${MINIO_ACCESS_KEY}"  # ä»ç¯å¢ƒå˜é‡è·å–
```

---

## ğŸ”’ å·²å®æ–½çš„å®‰å…¨æªæ–½

### 1. EXIF éšç§ä¿æŠ¤ âœ…

**é—®é¢˜**: EXIF æ•°æ®å¯èƒ½åŒ…å« GPS åœ°ç†ä½ç½®ä¿¡æ¯ï¼Œæ³„éœ²æ‹æ‘„åœ°ç‚¹éšç§ã€‚

**è§£å†³æ–¹æ¡ˆ**:
- âœ… Worker åœ¨å¤„ç†å›¾ç‰‡æ—¶è‡ªåŠ¨å‰¥ç¦»æ‰€æœ‰ GPS ç›¸å…³ä¿¡æ¯
- âœ… åªä¿ç•™ç›¸æœºå‚æ•°ï¼ˆå…‰åœˆã€å¿«é—¨ã€ISO ç­‰ï¼‰
- âœ… ç§»é™¤æ‰€æœ‰åŒ…å« `gps`ã€`location` çš„å­—æ®µ
- âœ… ç§»é™¤ `GPSInfo`ã€`GPSVersionID` ç­‰ GPS ç›¸å…³å­—æ®µ

**ä»£ç ä½ç½®**: `services/worker/src/processor.ts` - `sanitizeExif()` æ–¹æ³•

**æ•ˆæœ**: æ‰€æœ‰ä¸Šä¼ çš„ç…§ç‰‡éƒ½ä¼šè‡ªåŠ¨æ¸…ç†æ•æ„Ÿä½ç½®ä¿¡æ¯ï¼Œä¿æŠ¤ç”¨æˆ·éšç§ã€‚

**æµ‹è¯•æ–¹æ³•**:
1. ä¸Šä¼ ä¸€å¼ åŒ…å« GPS ä¿¡æ¯çš„ç…§ç‰‡
2. æ£€æŸ¥æ•°æ®åº“ä¸­çš„ `exif` å­—æ®µ
3. ç¡®è®¤æ²¡æœ‰ GPS ç›¸å…³å­—æ®µ

---

### 2. ä¸Šä¼ é€Ÿç‡é™åˆ¶ âœ…

**é—®é¢˜**: æ¶æ„ç”¨æˆ·å¯èƒ½é€šè¿‡å¤§é‡å¹¶å‘ä¸Šä¼ è€—å°½æœåŠ¡å™¨èµ„æºã€‚

**è§£å†³æ–¹æ¡ˆ**:
- âœ… æ¯ä¸ªç”¨æˆ·æ¯åˆ†é’Ÿæœ€å¤š 20 æ¬¡ä¸Šä¼ è¯·æ±‚
- âœ… åŸºäºç”¨æˆ· ID + IP åœ°å€çš„é€Ÿç‡é™åˆ¶
- âœ… è¿”å›æ ‡å‡†çš„ HTTP 429 çŠ¶æ€ç å’Œé‡è¯•æ—¶é—´

**ä»£ç ä½ç½®**: 
- `apps/web/src/middleware-rate-limit.ts` - é€Ÿç‡é™åˆ¶å·¥å…·
- `apps/web/src/app/api/admin/albums/[id]/upload/route.ts` - ä¸Šä¼  API

**é™åˆ¶è§„åˆ™**:
- ä¸Šä¼ è¯·æ±‚: 20 æ¬¡/åˆ†é’Ÿ/ç”¨æˆ·
- æ–‡ä»¶å¤§å°: 100MB/æ–‡ä»¶
- æ–‡ä»¶ç±»å‹: ä»…å…è®¸å›¾ç‰‡æ ¼å¼ï¼ˆJPEG, PNG, HEIC, WebPï¼‰

**ç”Ÿäº§ç¯å¢ƒå»ºè®®**:
- ä½¿ç”¨ Redis å®ç°åˆ†å¸ƒå¼é€Ÿç‡é™åˆ¶
- åœ¨ Nginx å±‚é…ç½®æ›´ä¸¥æ ¼çš„é™åˆ¶
- ç›‘æ§å¼‚å¸¸ä¸Šä¼ è¡Œä¸º

---

### 3. å¯†ç ä¿æŠ¤ âœ…

**é—®é¢˜**: UUID è™½ç„¶éš¾ä»¥çŒœæµ‹ï¼Œä½†ä¸€æ—¦æ³„éœ²ï¼Œä»»ä½•äººéƒ½èƒ½è®¿é—®ç›¸å†Œã€‚

**è§£å†³æ–¹æ¡ˆ**:
- âœ… æ”¯æŒä¸ºç›¸å†Œè®¾ç½®è®¿é—®å¯†ç 
- âœ… å¯†ç éªŒè¯ API
- âœ… å¯†ç éªŒè¯å¤±è´¥è¿”å› 401 é”™è¯¯
- âœ… ç›¸å†Œ API è¿”å› `requires_password` å­—æ®µï¼ˆä¸è¿”å›å¯†ç æœ¬èº«ï¼‰

**ä»£ç ä½ç½®**:
- `apps/web/src/app/api/public/albums/[slug]/verify-password/route.ts` - å¯†ç éªŒè¯
- `apps/web/src/app/api/public/albums/[slug]/route.ts` - ç›¸å†Œä¿¡æ¯ï¼ˆä¸è¿”å›å¯†ç ï¼‰
- `docker/init-postgresql-db.sql` - åŒ…å«å¯†ç å­—æ®µåœ¨å†…çš„å®Œæ•´æ•°æ®åº“æ¶æ„

**ä½¿ç”¨æ–¹å¼**:
1. ç®¡ç†å‘˜åœ¨ç›¸å†Œè®¾ç½®ä¸­è®¾ç½®å¯†ç 
2. è®¿å®¢è®¿é—®ç›¸å†Œæ—¶ï¼ŒAPI è¿”å› `requires_password: true`
3. å‰ç«¯è°ƒç”¨ `/api/public/albums/[slug]/verify-password` éªŒè¯å¯†ç 
4. å¯†ç éªŒè¯é€šè¿‡åï¼Œå¯ä»¥æ­£å¸¸æµè§ˆç›¸å†Œ

**å®‰å…¨å»ºè®®**:
- å½“å‰ä½¿ç”¨æ˜æ–‡å­˜å‚¨ï¼ˆå‘åå…¼å®¹ï¼‰
- **ç”Ÿäº§ç¯å¢ƒå»ºè®®**: ä½¿ç”¨ bcrypt åŠ å¯†å­˜å‚¨å¯†ç 
- å»ºè®®å¯†ç é•¿åº¦è‡³å°‘ 6 ä½
- å®šæœŸæ›´æ¢å¯†ç 
- å¯¹é«˜ç§å¯†æ€§ç›¸å†Œå¿…é¡»è®¾ç½®å¯†ç 

---

### 4. è®¿é—®æ§åˆ¶

**å·²å®æ–½**:
- âœ… ç›¸å†Œè¿‡æœŸæ—¶é—´æ§åˆ¶
- âœ… è½¯åˆ é™¤æœºåˆ¶ï¼ˆ`deleted_at`ï¼‰
- âœ… RLS (Row Level Security) ç­–ç•¥
- âœ… å…¬å¼€/ç§æœ‰ç›¸å†Œæ§åˆ¶

**æ•°æ®åº“å®‰å…¨**:
- âœ… æ‰€æœ‰è¡¨å¯ç”¨ RLS
- âœ… ç®¡ç†å‘˜ä½¿ç”¨ Service Role Keyï¼ˆç»•è¿‡ RLSï¼‰
- âœ… è®¿å®¢åªèƒ½è®¿é—®å…¬å¼€ç›¸å†Œæˆ–é€šè¿‡å¯†ç éªŒè¯çš„ç›¸å†Œ

---

## âš ï¸ éœ€è¦é…ç½®çš„å®‰å…¨æªæ–½

### 1. HTTPS é…ç½®

**é‡è¦**: ç”Ÿäº§ç¯å¢ƒåº”å¯ç”¨ HTTPSã€‚

---

### 2. CORS å’Œå®‰å…¨å¤´é…ç½® âœ…

**é—®é¢˜**: å¦‚æœ CORS é…ç½®è¿‡å®½ï¼Œæ¶æ„ç½‘ç«™å¯ä»¥åµŒå…¥ä½ çš„å›¾ç‰‡ã€‚

**è§£å†³æ–¹æ¡ˆ**:
- âœ… é™åˆ¶ `Access-Control-Allow-Origin` ä¸ºä½ çš„åŸŸåï¼ˆä¸æ˜¯ `*`ï¼‰
- âœ… æ·»åŠ å®‰å…¨å“åº”å¤´ï¼ˆX-Content-Type-Options, X-Frame-Options ç­‰ï¼‰
- âœ… é™åˆ¶æƒé™ç­–ç•¥ï¼ˆPermissions-Policyï¼‰

**ä»£ç ä½ç½®**: `apps/web/next.config.ts` - `headers()` é…ç½®

**å·²é…ç½®çš„å®‰å…¨å¤´**:
- `Access-Control-Allow-Origin`: é™åˆ¶ä¸ºä½ çš„åŸŸå
- `X-Content-Type-Options: nosniff`: é˜²æ­¢ MIME ç±»å‹å—…æ¢
- `X-Frame-Options: DENY`: é˜²æ­¢ç‚¹å‡»åŠ«æŒ
- `X-XSS-Protection: 1; mode=block`: XSS ä¿æŠ¤
- `Referrer-Policy: strict-origin-when-cross-origin`: æ§åˆ¶ Referer ä¿¡æ¯
- `Permissions-Policy`: ç¦ç”¨æ‘„åƒå¤´ã€éº¦å…‹é£ã€åœ°ç†ä½ç½®

**MinIO CORS é…ç½®**:
```json
{
  "CORSRules": [
    {
      "AllowedOrigins": ["https://yourdomain.com"],
      "AllowedMethods": ["GET", "PUT", "POST", "DELETE"],
      "AllowedHeaders": ["*"],
      "ExposeHeaders": ["ETag"],
      "MaxAgeSeconds": 3000
    }
  ]
}
```

---

### 3. Nginx é€Ÿç‡é™åˆ¶

**å»ºè®®**: åœ¨ Nginx å±‚é…ç½®æ›´ä¸¥æ ¼çš„é€Ÿç‡é™åˆ¶ã€‚

**é…ç½®æ–‡ä»¶**: `docker/nginx/rate-limit.conf` - é€Ÿç‡é™åˆ¶é…ç½®ç¤ºä¾‹

**Nginx é…ç½®ç¤ºä¾‹**:
```nginx
# å®šä¹‰é€Ÿç‡é™åˆ¶åŒºåŸŸ
limit_req_zone $binary_remote_addr zone=upload_limit:10m rate=10r/m;
limit_req_zone $binary_remote_addr zone=api_limit:10m rate=60r/m;
limit_req_zone $binary_remote_addr zone=global_limit:10m rate=100r/m;

server {
    # ä¸Šä¼ æ¥å£é™åˆ¶
    location /api/admin/albums/[id]/upload {
        limit_req zone=upload_limit burst=5 nodelay;
        limit_req_status 429;
        proxy_pass http://nextjs:3000;
    }
    
    # API æ¥å£é™åˆ¶
    location /api/ {
        limit_req zone=api_limit burst=20 nodelay;
        limit_req_status 429;
        proxy_pass http://nextjs:3000;
    }
    
    # å…¨å±€é™åˆ¶
    location / {
        limit_req zone=global_limit burst=50 nodelay;
        proxy_pass http://nextjs:3000;
    }
}
```

**è¯´æ˜**:
- `burst`: å…è®¸çªå‘è¯·æ±‚æ•°
- `nodelay`: ç«‹å³å¤„ç†çªå‘è¯·æ±‚
- `limit_req_status 429`: è¶…è¿‡é™åˆ¶æ—¶è¿”å› 429 çŠ¶æ€ç 

---

### 4. ç¯å¢ƒå˜é‡å®‰å…¨

**å¿…é¡»ä¿æŠ¤çš„ç¯å¢ƒå˜é‡**:
- `SUPABASE_SERVICE_ROLE_KEY` - æ‹¥æœ‰å®Œå…¨æ•°æ®åº“æƒé™
- `MINIO_SECRET_KEY` - MinIO è®¿é—®å¯†é’¥
- `SUPABASE_URL` - Supabase é¡¹ç›® URL
- `NEXT_PUBLIC_SUPABASE_ANON_KEY` - è™½ç„¶å…¬å¼€ï¼Œä½†åº”é™åˆ¶ä½¿ç”¨

**å®‰å…¨å»ºè®®**:
- âœ… ä½¿ç”¨å¼ºå¯†ç ï¼ˆè‡³å°‘ 32 ä½éšæœºå­—ç¬¦ä¸²ï¼‰
- âœ… å®šæœŸè½®æ¢å¯†é’¥
- âœ… ä¸è¦å°† `.env` æ–‡ä»¶æäº¤åˆ° Git
- âœ… ä½¿ç”¨å¯†é’¥ç®¡ç†æœåŠ¡ï¼ˆå¦‚ AWS Secrets Managerï¼‰

---

### 5. æ–‡ä»¶å¤§å°é™åˆ¶

**å½“å‰é™åˆ¶**:
- å•æ–‡ä»¶: 100MB
- Worker å¹¶å‘: 5 ä¸ªä»»åŠ¡
- Worker é€Ÿç‡: 10 ä»»åŠ¡/ç§’

**å»ºè®®**:
- æ ¹æ®æœåŠ¡å™¨é…ç½®è°ƒæ•´å¹¶å‘æ•°
- ç›‘æ§ç£ç›˜ä½¿ç”¨æƒ…å†µ
- è®¾ç½®è‡ªåŠ¨æ¸…ç†ç­–ç•¥ï¼ˆåˆ é™¤ 30 å¤©å‰çš„ä¸´æ—¶æ–‡ä»¶ï¼‰

---

## ğŸ›¡ï¸ å®‰å…¨æ£€æŸ¥æ¸…å•

### ğŸ” ç¯å¢ƒå˜é‡å®‰å…¨

**å¿…é¡»é…ç½®**:
- [ ] `SUPABASE_SERVICE_ROLE_KEY` - å·²è®¾ç½®ä¸ºå¼ºå¯†ç ï¼ˆè‡³å°‘ 32 ä½éšæœºå­—ç¬¦ä¸²ï¼‰
- [ ] `MINIO_SECRET_KEY` - å·²è®¾ç½®ä¸ºå¼ºå¯†ç ï¼ˆè‡³å°‘ 32 ä½éšæœºå­—ç¬¦ä¸²ï¼‰
- [ ] `MINIO_ACCESS_KEY` - å·²è®¾ç½®ä¸ºå¼ºå¯†ç 
- [ ] `.env` æ–‡ä»¶å·²æ·»åŠ åˆ° `.gitignore`
- [ ] ç”Ÿäº§ç¯å¢ƒä½¿ç”¨å¯†é’¥ç®¡ç†æœåŠ¡ï¼ˆå¦‚ AWS Secrets Managerï¼‰

**æ£€æŸ¥å‘½ä»¤**:
```bash
# æ£€æŸ¥ç¯å¢ƒå˜é‡æ˜¯å¦æ³„éœ²
grep -r "SUPABASE_SERVICE_ROLE_KEY\|MINIO_SECRET_KEY" .git/
# åº”è¯¥æ²¡æœ‰è¾“å‡º
```

### ğŸ”’ HTTPS é…ç½®

**Nginx é…ç½®**:
- [ ] SSL è¯ä¹¦å·²é…ç½®
- [ ] å¼ºåˆ¶ HTTPS é‡å®šå‘
- [ ] TLS ç‰ˆæœ¬ >= 1.2
- [ ] ç¦ç”¨ä¸å®‰å…¨çš„åŠ å¯†å¥—ä»¶

**æ£€æŸ¥é¡¹**:
```nginx
# å¿…é¡»é…ç½®
listen 443 ssl http2;
ssl_certificate /path/to/cert.pem;
ssl_certificate_key /path/to/key.pem;
ssl_protocols TLSv1.2 TLSv1.3;

# å¿…é¡»é‡å®šå‘ HTTP åˆ° HTTPS
server {
    listen 80;
    return 301 https://$host$request_uri;
}
```

### ğŸ›¡ï¸ CORS é…ç½®

**Next.js é…ç½®**:
- [ ] `Access-Control-Allow-Origin` ä¸æ˜¯ `*`
- [ ] é™åˆ¶ä¸ºä½ çš„åŸŸå

**æ£€æŸ¥é¡¹** (`next.config.ts`):
```typescript
headers: [
  {
    key: 'Access-Control-Allow-Origin',
    value: 'https://yourdomain.com', // ä¸æ˜¯ '*'
  },
]
```

**MinIO CORS é…ç½®**:
- [ ] CORS è§„åˆ™å·²è®¾ç½®
- [ ] åªå…è®¸ä½ çš„åŸŸå

### âš¡ é€Ÿç‡é™åˆ¶

**Nginx å±‚é™åˆ¶**:
- [ ] ä¸Šä¼ æ¥å£é€Ÿç‡é™åˆ¶ï¼ˆå»ºè®®ï¼š10 æ¬¡/åˆ†é’Ÿï¼‰
- [ ] API æ¥å£é€Ÿç‡é™åˆ¶ï¼ˆå»ºè®®ï¼š60 æ¬¡/åˆ†é’Ÿï¼‰
- [ ] å…¨å±€é€Ÿç‡é™åˆ¶ï¼ˆå»ºè®®ï¼š100 æ¬¡/åˆ†é’Ÿï¼‰

**åº”ç”¨å±‚é™åˆ¶**:
- [x] ä¸Šä¼  API å·²å¯ç”¨é€Ÿç‡é™åˆ¶ï¼ˆâœ… å·²å®ç°ï¼š20 æ¬¡/åˆ†é’Ÿï¼‰
- [x] ç™»å½• API å·²å¯ç”¨é€Ÿç‡é™åˆ¶ï¼ˆâœ… å·²å®ç°ï¼š5 æ¬¡/åˆ†é’Ÿ/IPï¼Œé˜²æ­¢æ’åº“æ”»å‡»ï¼‰
- [ ] å…¶ä»–æ•æ„Ÿ API å·²å¯ç”¨é€Ÿç‡é™åˆ¶

### ğŸ” ç™»å½•å®‰å…¨ âœ…

**å·²å®æ–½**:
- âœ… **æœåŠ¡ç«¯ç™»å½•éªŒè¯**ï¼šç™»å½•é€»è¾‘å®Œå…¨åœ¨æœåŠ¡ç«¯æ‰§è¡Œï¼Œå®¢æˆ·ç«¯æ— æ³•ç»•è¿‡
- âœ… **åŒé‡é€Ÿç‡é™åˆ¶**ï¼š
  - åŸºäº IPï¼š5 æ¬¡/åˆ†é’Ÿï¼ˆé˜²æ­¢å• IP æš´åŠ›ç ´è§£ï¼‰
  - åŸºäºé‚®ç®±ï¼š3 æ¬¡/åˆ†é’Ÿï¼ˆé˜²æ­¢é’ˆå¯¹ç‰¹å®šè´¦æˆ·çš„æ”»å‡»ï¼‰
- âœ… **æ”¹è¿›çš„ IP æå–**ï¼šæ”¯æŒ Cloudflareã€ä»£ç†æœåŠ¡å™¨ç­‰å¤šç§åœºæ™¯
- âœ… **ç»Ÿä¸€é”™è¯¯æ¶ˆæ¯**ï¼šä¸æš´éœ²å…·ä½“é”™è¯¯åŸå› ï¼ˆé˜²æ­¢ç”¨æˆ·æšä¸¾å’Œä¿¡æ¯æ³„éœ²ï¼‰
- âœ… **å†…å­˜ç®¡ç†**ï¼šè‡ªåŠ¨æ¸…ç†è¿‡æœŸè®°å½•ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼å’Œ DoS æ”»å‡»
- âœ… Supabase Auth å†…ç½®ä¿æŠ¤ï¼šSupabase æœ¬èº«æœ‰é€Ÿç‡é™åˆ¶ï¼ˆåŒé‡ä¿æŠ¤ï¼‰

**ä»£ç ä½ç½®**:
- `apps/web/src/app/api/auth/login/route.ts` - æœåŠ¡ç«¯ç™»å½• APIï¼ˆåŒ…å«é€Ÿç‡é™åˆ¶å’Œç™»å½•é€»è¾‘ï¼‰
- `apps/web/src/app/admin/login/page.tsx` - ç™»å½•é¡µé¢ï¼ˆåªè°ƒç”¨æœåŠ¡ç«¯ APIï¼‰
- `apps/web/src/middleware-rate-limit.ts` - é€Ÿç‡é™åˆ¶å·¥å…·ï¼ˆæ”¹è¿›çš„å†…å­˜ç®¡ç†ï¼‰

**é™åˆ¶è§„åˆ™**:
- IP é€Ÿç‡é™åˆ¶: 5 æ¬¡/åˆ†é’Ÿ/IP
- é‚®ç®±é€Ÿç‡é™åˆ¶: 3 æ¬¡/åˆ†é’Ÿ/é‚®ç®±
- è¶…è¿‡é™åˆ¶åéœ€è¦ç­‰å¾… 1 åˆ†é’Ÿæ‰èƒ½é‡è¯•
- è¿”å› HTTP 429 çŠ¶æ€ç å’Œ `Retry-After` å¤´

**å®‰å…¨ç‰¹æ€§**:
- âœ… å®¢æˆ·ç«¯æ— æ³•ç»•è¿‡é€Ÿç‡é™åˆ¶ï¼ˆç™»å½•é€»è¾‘åœ¨æœåŠ¡ç«¯ï¼‰
- âœ… ç»Ÿä¸€é”™è¯¯æ¶ˆæ¯ï¼ˆä¸æ³„éœ²å…·ä½“é”™è¯¯åŸå› ï¼‰
- âœ… åŒé‡é™åˆ¶ï¼ˆIP + é‚®ç®±ï¼‰
- âœ… è‡ªåŠ¨å†…å­˜æ¸…ç†ï¼ˆé˜²æ­¢å†…å­˜æ³„æ¼ï¼‰

**è¯¦ç»†å®¡è®¡æŠ¥å‘Š**: ç™»å½•å®‰å…¨åŠŸèƒ½å·²å®Œæ•´å®ç°ï¼Œè¯¦è§æœ¬æ–‡æ¡£çš„ [ç™»å½•å®‰å…¨](#-ç™»å½•å®‰å…¨-) ç« èŠ‚

**å·²æ”¹è¿›**:
- âœ… é‚®ç®±æ ¼å¼éªŒè¯ï¼šä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼éªŒè¯é‚®ç®±æ ¼å¼
- âœ… è¾“å…¥é•¿åº¦é™åˆ¶ï¼šé™åˆ¶é‚®ç®±ï¼ˆ254å­—ç¬¦ï¼‰å’Œå¯†ç ï¼ˆ128å­—ç¬¦ï¼‰æœ€å¤§é•¿åº¦
- âœ… ç™»å½•å°è¯•æ—¥å¿—ï¼šè®°å½•æ‰€æœ‰ç™»å½•å°è¯•ï¼ˆæˆåŠŸ/å¤±è´¥ï¼‰ï¼Œç”¨äºå®‰å…¨å®¡è®¡

**å¯é€‰å¢å¼º**:
- âœ… **Cloudflare Turnstile**ï¼šå·²å®ç° Invisible æ¨¡å¼ï¼ˆå¯é€‰ï¼Œå®Œå…¨å…è´¹ï¼‰
  - å®Œå…¨åå°éªŒè¯ï¼Œç”¨æˆ·æ— æ„ŸçŸ¥
  - é˜²æ­¢è‡ªåŠ¨åŒ–æ”»å‡»å’Œæœºå™¨äºº
  - é…ç½®æ–¹å¼ï¼šå‚è§æœ¬æ–‡æ¡£çš„ [Cloudflare Turnstile é…ç½®](#-cloudflare-turnstile-é…ç½®) ç« èŠ‚
  - å¦‚æœä¸é…ç½®ï¼Œç™»å½•åŠŸèƒ½ä»ç„¶æ­£å¸¸å·¥ä½œï¼ˆé™çº§ç­–ç•¥ï¼‰

**ç”Ÿäº§ç¯å¢ƒå»ºè®®**:
- [ ] ä½¿ç”¨ Redis å®ç°åˆ†å¸ƒå¼é€Ÿç‡é™åˆ¶ï¼ˆå¤šæœåŠ¡å™¨éƒ¨ç½²æ—¶ï¼‰
- [ ] æ·»åŠ è´¦æˆ·é”å®šæœºåˆ¶ï¼ˆè¿ç»­å¤±è´¥ 5 æ¬¡åé”å®š 15 åˆ†é’Ÿï¼‰
- [ ] å°†ç™»å½•æ—¥å¿—å‘é€åˆ°æ—¥å¿—æœåŠ¡ï¼ˆå¦‚ Sentry, LogRocketï¼‰
- [ ] ç›‘æ§å¼‚å¸¸ç™»å½•è¡Œä¸ºï¼ˆå¼‚åœ°ç™»å½•ã€å¼‚å¸¸æ—¶é—´ç­‰ï¼‰
- [ ] å¯ç”¨åŒå› ç´ è®¤è¯ï¼ˆ2FAï¼‰

**è¯¦ç»†è¡¥å……å®¡è®¡æŠ¥å‘Š**: ç™»å½•å®‰å…¨åŠŸèƒ½å·²å®Œæ•´å®ç°ï¼Œè¯¦è§æœ¬æ–‡æ¡£çš„ [ç™»å½•å®‰å…¨](#-ç™»å½•å®‰å…¨-) ç« èŠ‚

### ğŸ” EXIF éšç§ä¿æŠ¤

- [ ] Worker å·²æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ï¼ˆåŒ…å« EXIF æ¸…ç†åŠŸèƒ½ï¼‰
- [ ] æµ‹è¯•ä¸Šä¼ ç…§ç‰‡ï¼Œç¡®è®¤ GPS ä¿¡æ¯å·²è¢«ç§»é™¤

**æµ‹è¯•æ–¹æ³•**:
1. ä¸Šä¼ ä¸€å¼ åŒ…å« GPS ä¿¡æ¯çš„ç…§ç‰‡
2. æ£€æŸ¥æ•°æ®åº“ä¸­çš„ `exif` å­—æ®µ
3. ç¡®è®¤æ²¡æœ‰ `gps`ã€`GPSInfo` ç­‰å­—æ®µ

### ğŸ—„ï¸ æ•°æ®åº“å®‰å…¨

**RLS ç­–ç•¥**:
- [ ] æ‰€æœ‰è¡¨å·²å¯ç”¨ RLS
- [ ] RLS ç­–ç•¥å·²æµ‹è¯•
- [ ] åŒ¿åç”¨æˆ·æƒé™å·²é™åˆ¶

**æ£€æŸ¥å‘½ä»¤** (Supabase SQL Editor):
```sql
-- æ£€æŸ¥æ‰€æœ‰è¡¨çš„ RLS çŠ¶æ€
SELECT tablename, rowsecurity 
FROM pg_tables 
WHERE schemaname = 'public';

-- åº”è¯¥æ‰€æœ‰è¡¨éƒ½æ˜¯ true
```

**å¯†ç å­˜å‚¨**:
- [x] å¯†ç å­—æ®µå·²æ·»åŠ ï¼ˆâœ… å·²å®ç°ï¼‰
- [x] å¯†ç éªŒè¯ API å·²å®ç°ï¼ˆâœ… å·²å®ç°ï¼‰
- [ ] å»ºè®®ï¼šä½¿ç”¨ bcrypt åŠ å¯†å­˜å‚¨ï¼ˆå¯é€‰ï¼Œå½“å‰æ”¯æŒæ˜æ–‡å‘åå…¼å®¹ï¼‰

### ğŸ“ æ–‡ä»¶å­˜å‚¨å®‰å…¨

**MinIO é…ç½®**:
- [ ] MinIO è®¿é—®å¯†é’¥å·²æ›´æ¢
- [ ] MinIO ä½¿ç”¨ HTTPS
- [ ] Bucket ç­–ç•¥å·²é…ç½®
- [ ] å®šæœŸå¤‡ä»½ç­–ç•¥å·²è®¾ç½®

### ğŸ” è®¿é—®æ§åˆ¶

**ç›¸å†Œè®¿é—®**:
- [ ] å¯†ç ä¿æŠ¤åŠŸèƒ½å·²æµ‹è¯•
- [ ] è¿‡æœŸæ—¶é—´åŠŸèƒ½å·²æµ‹è¯•
- [ ] è½¯åˆ é™¤åŠŸèƒ½å·²æµ‹è¯•

**ç®¡ç†å‘˜æƒé™**:
- [ ] åªæœ‰è®¤è¯ç”¨æˆ·æ‰èƒ½è®¿é—®ç®¡ç†åå°
- [ ] Service Role Key æœªæ³„éœ²
- [ ] ç®¡ç†å‘˜è´¦æˆ·ä½¿ç”¨å¼ºå¯†ç 

### ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

**æ—¥å¿—é…ç½®**:
- [ ] API é”™è¯¯æ—¥å¿—å·²é…ç½®
- [ ] Worker å¤„ç†æ—¥å¿—å·²é…ç½®
- [ ] å¼‚å¸¸è¡Œä¸ºç›‘æ§å·²è®¾ç½®

**ç›‘æ§æŒ‡æ ‡**:
- [ ] ç£ç›˜ä½¿ç”¨ç‡ç›‘æ§
- [ ] API å“åº”æ—¶é—´ç›‘æ§
- [ ] é”™è¯¯ç‡ç›‘æ§
- [ ] å¼‚å¸¸ä¸Šä¼ è¡Œä¸ºå‘Šè­¦

### ğŸš¨ åº”æ€¥å“åº”

**å®‰å…¨äº‹ä»¶å¤„ç†**:
- [ ] å®‰å…¨äº‹ä»¶å“åº”æµç¨‹å·²åˆ¶å®š
- [ ] å¯†é’¥æ³„éœ²å¤„ç†æµç¨‹å·²åˆ¶å®š
- [ ] æ•°æ®æ³„éœ²å¤„ç†æµç¨‹å·²åˆ¶å®š

### âœ… éƒ¨ç½²å‰æœ€ç»ˆæ£€æŸ¥

1. [ ] æ‰€æœ‰ç¯å¢ƒå˜é‡å·²è®¾ç½®
2. [ ] HTTPS å·²é…ç½®å¹¶æµ‹è¯•
3. [ ] CORS é…ç½®æ­£ç¡®
4. [ ] é€Ÿç‡é™åˆ¶å·²é…ç½®
5. [ ] æ•°æ®åº“è¿ç§»å·²æ‰§è¡Œ
6. [ ] RLS ç­–ç•¥å·²å¯ç”¨
7. [ ] å¯†ç åŠŸèƒ½å·²æµ‹è¯•
8. [ ] EXIF æ¸…ç†åŠŸèƒ½å·²æµ‹è¯•
9. [ ] ç›‘æ§å’Œæ—¥å¿—å·²é…ç½®
10. [ ] å¤‡ä»½ç­–ç•¥å·²è®¾ç½®

---

## ğŸ” æ½œåœ¨é£é™©ä¸ç¼“è§£æªæ–½

### 1. UUID éå†é£é™©

**é£é™©**: UUID è™½ç„¶éš¾ä»¥çŒœæµ‹ï¼Œä½†ä¸€æ—¦æ³„éœ²ï¼Œä»»ä½•äººéƒ½èƒ½è®¿é—®ã€‚

**ç¼“è§£æªæ–½**:
- âœ… æ”¯æŒå¯†ç ä¿æŠ¤
- âœ… æ”¯æŒè¿‡æœŸæ—¶é—´
- âœ… å»ºè®®ï¼šå¯¹é«˜ç§å¯†æ€§ç›¸å†Œå¿…é¡»è®¾ç½®å¯†ç 

**æœªæ¥æ”¹è¿›**:
- è€ƒè™‘æ·»åŠ "ç”³è¯·è®¿é—®"åŠŸèƒ½
- è€ƒè™‘æ·»åŠ è®¿é—®æ—¥å¿—

---

### 2. DoS æ”»å‡»

**é£é™©**: æ¶æ„ç”¨æˆ·å¯èƒ½é€šè¿‡å¤§é‡è¯·æ±‚è€—å°½æœåŠ¡å™¨èµ„æºã€‚

**ç¼“è§£æªæ–½**:
- âœ… åº”ç”¨å±‚é€Ÿç‡é™åˆ¶
- âš ï¸ å»ºè®®ï¼šNginx å±‚é€Ÿç‡é™åˆ¶
- âš ï¸ å»ºè®®ï¼šä½¿ç”¨ CDN å’Œ DDoS é˜²æŠ¤

---

### 3. EXIF éšç§æ³„éœ²

**é£é™©**: GPS ä¿¡æ¯å¯èƒ½æ³„éœ²æ‹æ‘„åœ°ç‚¹ã€‚

**ç¼“è§£æªæ–½**:
- âœ… è‡ªåŠ¨å‰¥ç¦» GPS ä¿¡æ¯
- âœ… åªä¿ç•™ç›¸æœºå‚æ•°

---

### 4. SSRF (Server-Side Request Forgery)

**é£é™©**: å¦‚æœæœªæ¥æ·»åŠ "ä» URL æŠ“å–å›¾ç‰‡"åŠŸèƒ½ï¼Œå¯èƒ½è¢«åˆ©ç”¨æ”»å‡»å†…ç½‘ã€‚

**å½“å‰çŠ¶æ€**: âœ… æ— æ­¤åŠŸèƒ½ï¼Œé£é™©ä½

**æœªæ¥å»ºè®®**:
- å¦‚æœæ·»åŠ æ­¤åŠŸèƒ½ï¼Œå¿…é¡»éªŒè¯ URL ç™½åå•
- ç¦æ­¢è®¿é—®å†…ç½‘ IPï¼ˆ127.0.0.1, 10.x.x.x, 192.168.x.xï¼‰
- ä½¿ç”¨ä»£ç†æœåŠ¡å™¨éš”ç¦»è¯·æ±‚

---

### 5. SQL æ³¨å…¥

**é£é™©**: ç”¨æˆ·è¾“å…¥æœªæ­£ç¡®è½¬ä¹‰å¯èƒ½å¯¼è‡´ SQL æ³¨å…¥ã€‚

**ç¼“è§£æªæ–½**:
- âœ… ä½¿ç”¨ Supabase å®¢æˆ·ç«¯ï¼ˆè‡ªåŠ¨è½¬ä¹‰ï¼‰
- âœ… ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢
- âœ… RLS ç­–ç•¥é™åˆ¶æ•°æ®è®¿é—®

---

## ğŸ” Turnstile é…ç½®ï¼ˆå¯é€‰ï¼‰

Turnstile ç”¨äºé˜²æ­¢æœºå™¨äººæ”»å‡»ï¼Œæ”¯æŒ Invisible æ¨¡å¼ã€‚

### é…ç½®ç¯å¢ƒå˜é‡

```bash
NEXT_PUBLIC_TURNSTILE_SITE_KEY=your-site-key
TURNSTILE_SECRET_KEY=your-secret-key
```

---

## ğŸ“ æ•æ„Ÿæ–‡æ¡£ç®¡ç†

> ç®¡ç†åŒ…å«æ•æ„Ÿä¿¡æ¯çš„æ–‡æ¡£ï¼Œç¡®ä¿ä¸ä¼šæ³„éœ²åˆ°å…¬å¼€ä»“åº“

### âš ï¸ é‡è¦æç¤º

ä»¥ä¸‹æ–‡æ¡£åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼ˆAPI å¯†é’¥ã€Tokenã€å¯†ç ç­‰ï¼‰ï¼Œ**ä¸ä¼šæäº¤åˆ° Git**ï¼š

- `ENVIRONMENT_VARIABLES.md` - åŒ…å«çœŸå®çš„ç¯å¢ƒå˜é‡é…ç½®
- `ARCHITECTURE.md` - åŒ…å«çœŸå®çš„æœåŠ¡å™¨ IPã€åŸŸåå’Œé…ç½®
- ç¯å¢ƒå˜é‡é…ç½®æ–‡æ¡£ï¼ˆåŒ…å«æ•æ„Ÿä¿¡æ¯ï¼‰
- `ENGINEER_REFERENCE.md` - åŒ…å«çœŸå®çš„é…ç½®ä¿¡æ¯

### ğŸ“ ç¤ºä¾‹æ–‡æ¡£

è¿™äº›æ–‡æ¡£çš„ç¤ºä¾‹ç‰ˆæœ¬ï¼ˆ`.example.md`ï¼‰å·²æäº¤åˆ° Gitï¼Œæ‰€æœ‰æ•æ„Ÿä¿¡æ¯å·²ç”¨å ä½ç¬¦æ›¿æ¢ï¼š

- `ENVIRONMENT_VARIABLES.example.md`
- `ARCHITECTURE.example.md`
- `VERCEL_ENV_QUICK_REFERENCE.example.md`
- `ENGINEER_REFERENCE.example.md`

### ğŸ”§ å¦‚ä½•æ›´æ–°ç¤ºä¾‹æ–‡æ¡£

å¦‚æœåŸå§‹æ–‡æ¡£æœ‰æ›´æ–°ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤é‡æ–°ç”Ÿæˆç¤ºä¾‹ç‰ˆæœ¬ï¼š

```bash
python3 scripts/create-example-docs.py
```

è¿™ä¸ªè„šæœ¬ä¼šï¼š
1. è¯»å–åŸå§‹æ–‡æ¡£
2. ç”¨å ä½ç¬¦æ›¿æ¢æ‰€æœ‰æ•æ„Ÿä¿¡æ¯
3. ç”Ÿæˆ `.example.md` æ–‡ä»¶

### ğŸ“‹ æ•æ„Ÿä¿¡æ¯æ›¿æ¢è§„åˆ™

è„šæœ¬ä¼šæ›¿æ¢ä»¥ä¸‹æ•æ„Ÿä¿¡æ¯ï¼š

- **Supabase**: URL å’Œ JWT tokens â†’ `your-project-id.supabase.co` å’Œ `eyJhbGci...`
- **Worker API Key**: 64 å­—ç¬¦åå…­è¿›åˆ¶å­—ç¬¦ä¸² â†’ `your-worker-api-key-here`
- API Token å’Œ Zone ID â†’ `your-api-token` å’Œ `your-zone-id`
- Turnstile Secret Key â†’ `your-turnstile-key`
- å­˜å‚¨ Access Key å’Œ Secret Key â†’ `your-access-key` å’Œ `your-secret-key`
- åŸŸå â†’ `your-domain.com`
- æœåŠ¡å™¨ IP â†’ `your-server-ip`

### ğŸ”’ å®‰å…¨å»ºè®®

1. **ä¸è¦**å°†åŒ…å«æ•æ„Ÿä¿¡æ¯çš„æ–‡æ¡£æäº¤åˆ° Git
2. **ä¸è¦**åœ¨å…¬å¼€åœºåˆåˆ†äº«åŒ…å«çœŸå®é…ç½®çš„æ–‡æ¡£
3. **å®šæœŸ**æ£€æŸ¥ Git å†å²ï¼Œç¡®ä¿æ²¡æœ‰æ„å¤–æäº¤æ•æ„Ÿä¿¡æ¯
4. **ä½¿ç”¨** `.gitignore` ç¡®ä¿æ•æ„Ÿæ–‡ä»¶ä¸ä¼šè¢«è·Ÿè¸ª

### ğŸ“š ç›¸å…³æ–‡ä»¶

- `.gitignore` - å·²é…ç½®å¿½ç•¥æ•æ„Ÿæ–‡æ¡£
- `scripts/create-example-docs.py` - ç”Ÿæˆç¤ºä¾‹æ–‡æ¡£çš„è„šæœ¬

---

## ğŸ“š å‚è€ƒèµ„æº

- [OWASP Top 10](https://owasp.org/www-project-top-ten/)
- [Next.js Security Best Practices](https://nextjs.org/docs/app/building-your-application/configuring/security-headers)
- [Supabase Security](https://supabase.com/docs/guides/platform/security)
- [MinIO Security](https://min.io/docs/minio/linux/operations/security.html)

---

**æœ€åæ›´æ–°**: 2026-01-27

---

## ğŸ“‹ å¼€æºå‰å®‰å…¨æ£€æŸ¥æ¸…å•

åœ¨å…¬å¼€ GitHub ä»“åº“ä¹‹å‰ï¼Œè¯·å®Œæˆä»¥ä¸‹æ£€æŸ¥ï¼š

### 1. æ•æ„Ÿæ–‡ä»¶æ£€æŸ¥

ç¡®è®¤ä»¥ä¸‹æ–‡ä»¶**æœªè¢« Git è·Ÿè¸ª**ï¼š

```bash
# æ£€æŸ¥æ˜¯å¦æœ‰æ•æ„Ÿæ–‡ä»¶è¢« Git è·Ÿè¸ª
git ls-files | grep -E "\.env$|\.env\.local$|\.key$|\.pem$"
```

**é¢„æœŸç»“æœï¼š** åº”è¯¥æ²¡æœ‰è¾“å‡ºï¼Œè¡¨ç¤ºè¿™äº›æ–‡ä»¶æœªè¢«è·Ÿè¸ªã€‚

**éœ€è¦æ’é™¤çš„æ–‡ä»¶ï¼š**
- âœ… `.env` - åº”åœ¨ `.gitignore` ä¸­
- âœ… `services/worker/.env` - åº”åœ¨ `.gitignore` ä¸­
- âœ… æ‰€æœ‰å¯†é’¥æ–‡ä»¶ï¼ˆ`.key`, `.pem`, `.p12`ï¼‰
- âœ… SSH å¯†é’¥æ–‡ä»¶

### 2. Git å†å²æ£€æŸ¥

æ£€æŸ¥ Git å†å²ä¸­æ˜¯å¦æœ‰æ•æ„Ÿæ–‡ä»¶ï¼š

```bash
# æ£€æŸ¥ Git å†å²ä¸­æ˜¯å¦æœ‰æ•æ„Ÿæ–‡ä»¶
git log --all --full-history --source -- .env services/worker/.env
```

**é¢„æœŸç»“æœï¼š** åº”è¯¥æ²¡æœ‰è¾“å‡ºï¼Œè¡¨ç¤ºå†å²è®°å½•å¹²å‡€ã€‚

**å¦‚æœå‘ç°æ•æ„Ÿæ–‡ä»¶åœ¨å†å²ä¸­ï¼š**

```bash
# ä½¿ç”¨ git-filter-repoï¼ˆæ¨èï¼‰
pip install git-filter-repo
git filter-repo --path .env --path services/worker/.env --invert-paths

# âš ï¸ è­¦å‘Šï¼šè¿™ä¼šé‡å†™ Git å†å²ï¼Œå¦‚æœå·²æ¨é€åˆ°è¿œç¨‹ï¼Œéœ€è¦å¼ºåˆ¶æ¨é€
git push origin --force --all
```

### 3. ç¡¬ç¼–ç å¯†é’¥æ£€æŸ¥

æ£€æŸ¥ä»£ç ä¸­æ˜¯å¦æœ‰ç¡¬ç¼–ç çš„å¯†é’¥ï¼š

```bash
# æ£€æŸ¥ JWT tokens
grep -r "eyJ[A-Za-z0-9_-]\{50,\}" --exclude-dir=node_modules --exclude-dir=.git .

# æ£€æŸ¥ AWS keys
grep -r "AKIA[0-9A-Z]\{16\}" --exclude-dir=node_modules --exclude-dir=.git .

# æ£€æŸ¥å…¶ä»–å¸¸è§å¯†é’¥æ ¼å¼
grep -ri "password.*=.*['\"][^'\"]\{8,\}" --exclude-dir=node_modules --exclude-dir=.git .
```

**é¢„æœŸç»“æœï¼š** åº”è¯¥æ²¡æœ‰è¾“å‡ºï¼Œæˆ–åªæœ‰ `.env.example` ä¸­çš„å ä½ç¬¦ã€‚

### 4. ç¯å¢ƒå˜é‡ç¤ºä¾‹æ–‡ä»¶æ£€æŸ¥

ç¡®è®¤ `.env.example` åªåŒ…å«å ä½ç¬¦ï¼š

```bash
# æ£€æŸ¥ .env.example æ–‡ä»¶
cat .env.example | grep -E "(your-|eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9\.\.\.)"
```

**é¢„æœŸç»“æœï¼š** æ‰€æœ‰å€¼éƒ½åº”è¯¥æ˜¯å ä½ç¬¦ï¼ˆ`your-...`, `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...`ï¼‰

### 5. .gitignore é…ç½®æ£€æŸ¥

ç¡®è®¤ `.gitignore` åŒ…å«ä»¥ä¸‹è§„åˆ™ï¼š

```gitignore
# Environment files
.env
.env.*.local
!.env.example

# Keys and certificates
*.key
*.pem
*.p12
*.p8
id_rsa
id_rsa.pub
```

### ğŸ” è‡ªåŠ¨åŒ–å®‰å…¨æ£€æŸ¥

ä½¿ç”¨é¡¹ç›®æä¾›çš„å®‰å…¨æ£€æŸ¥è„šæœ¬ï¼š

```bash
# è¿è¡Œå®‰å…¨æ£€æŸ¥
bash scripts/check-security.sh
```

è„šæœ¬ä¼šæ£€æŸ¥ï¼š
1. æ•æ„Ÿæ–‡ä»¶æ˜¯å¦è¢« Git è·Ÿè¸ª
2. Git å†å²ä¸­æ˜¯å¦æœ‰æ•æ„Ÿæ–‡ä»¶
3. æ˜¯å¦æœ‰ç¡¬ç¼–ç çš„ JWT tokens
4. æ˜¯å¦æœ‰ AWS Access Keys
5. æ˜¯å¦æœ‰ç¡¬ç¼–ç çš„å¯†ç 
6. `.env.example` æ˜¯å¦åªåŒ…å«å ä½ç¬¦
7. `.gitignore` æ˜¯å¦æ­£ç¡®é…ç½®

**é¢„æœŸè¾“å‡ºï¼š**
```
âœ… å®‰å…¨æ£€æŸ¥é€šè¿‡ï¼å¯ä»¥å®‰å…¨åœ°å…¬å¼€ä»“åº“ã€‚
```

### âš ï¸ å¦‚æœå¯†é’¥å·²æ³„éœ²

å¦‚æœå‘ç°å¯†é’¥å·²ç»è¢«æäº¤åˆ°å…¬å¼€ä»“åº“ï¼š

1. **ç«‹å³æ’¤é”€æ‰€æœ‰å¯†é’¥**
   - **Supabase**: ç™»å½• Dashboard â†’ Settings â†’ API â†’ é‡æ–°ç”Ÿæˆ Service Role Key
   - ç™»å½•å¯¹åº”å¹³å°æ§åˆ¶å°ï¼Œåˆ é™¤æ³„éœ²çš„ token å¹¶ç”Ÿæˆæ–°çš„ token
   - **OSS/COS/S3**: ç™»å½•æ§åˆ¶å° â†’ é‡æ–°ç”Ÿæˆæ‰€æœ‰ Access Key

2. **ä» Git å†å²ä¸­åˆ é™¤**
   ```bash
   # ä½¿ç”¨ git-filter-repo
   pip install git-filter-repo
   git filter-repo --path .env --path services/worker/.env --invert-paths
   git push origin --force --all
   ```

3. **æ›´æ–°æœ¬åœ°é…ç½®**
   æ›´æ–°æ‰€æœ‰ `.env` æ–‡ä»¶ä¸­çš„å¯†é’¥ã€‚

### ğŸ“‹ å…¬å¼€ä»“åº“å‰çš„æœ€ç»ˆæ£€æŸ¥æ¸…å•

- [ ] ç¡®è®¤ `.env` æœªè¢« Git è·Ÿè¸ª
- [ ] ç¡®è®¤ `services/worker/.env` æœªè¢« Git è·Ÿè¸ª
- [ ] ç¡®è®¤ Git å†å²ä¸­æ²¡æœ‰æ•æ„Ÿæ–‡ä»¶
- [ ] ç¡®è®¤ä»£ç ä¸­æ²¡æœ‰ç¡¬ç¼–ç çš„å¯†é’¥
- [ ] ç¡®è®¤ `.env.example` åªåŒ…å«å ä½ç¬¦
- [ ] ç¡®è®¤æ–‡æ¡£ä¸­çš„ç¤ºä¾‹éƒ½æ˜¯å ä½ç¬¦
- [ ] ç¡®è®¤ `.gitignore` æ­£ç¡®é…ç½®
- [ ] å·²è¿è¡Œ `scripts/check-security.sh` å¹¶é€šè¿‡
- [ ] å¦‚æœå¯†é’¥å·²æ³„éœ²ï¼Œå·²é‡æ–°ç”Ÿæˆæ‰€æœ‰å¯†é’¥
- [ ] å·²æµ‹è¯•ä½¿ç”¨ `.env.example` å¯ä»¥æ­£å¸¸é…ç½®é¡¹ç›®

### ğŸš€ å…¬å¼€ä»“åº“æ­¥éª¤

1. **è¿è¡Œå®‰å…¨æ£€æŸ¥**
   ```bash
   bash scripts/check-security.sh
   ```

2. **ç¡®è®¤æ£€æŸ¥é€šè¿‡**
   - åº”è¯¥çœ‹åˆ° "âœ… å®‰å…¨æ£€æŸ¥é€šè¿‡ï¼å¯ä»¥å®‰å…¨åœ°å…¬å¼€ä»“åº“ã€‚"

3. **æäº¤ä»£ç **
   ```bash
   git add .
   git commit -m "chore: prepare for open source release"
   ```

4. **æ¨é€åˆ° GitHub**
   ```bash
   git push origin main
   ```

5. **åœ¨ GitHub ä¸Šè®¾ç½®ä¸ºå…¬å¼€**
   - Settings â†’ Change repository visibility â†’ Make public

---
